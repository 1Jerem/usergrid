window.console=window.console||{};window.console.log=window.console.log||function(){};window.Usergrid=window.Usergrid||{};Usergrid=Usergrid||{};Usergrid.SDK_VERSION="0.9.6";(function(){Usergrid.Query=function(a,b,c,d,e,f){this._method=a;this._resource=b;this._jsonObj=c;this._paramsObj=d;this._successCallback=e;this._failureCallback=f;this._curl="";this._token=false;this._cursor=null;this._next=null;this._previous=[];this._start=0;this._end=0};Usergrid.Query.prototype={setQueryStartTime:function(){this._start=(new Date).getTime()},setQueryEndTime:function(){this._end=(new Date).getTime()},getQueryTotalTime:function(){var a=0;var b=this._end-this._start;try{a=(b/10/60).toFixed(2)}catch(c){return 0}return this.getMethod()+" "+this.getResource()+" - "+a+" seconds"},setAllQueryParams:function(a,b,c,d,e,f){this._method=a;this._resource=b;this._jsonObj=c;this._paramsObj=d;this._successCallback=e;this._failureCallback=f},clearAll:function(){this._method=null;this._resource=null;this._jsonObj={};this._paramsObj={};this._successCallback=null;this._failureCallback=null},getMethod:function(){return this._method},setMethod:function(a){this._method=a},getResource:function(){return this._resource},setResource:function(a){this._resource=a},getJsonObj:function(){return this._jsonObj},setJsonObj:function(a){this._jsonObj=a},getQueryParams:function(){return this._paramsObj},setQueryParams:function(a){this._paramsObj=a},getSuccessCallback:function(){return this._successCallback},setSuccessCallback:function(a){this._successCallback=a},callSuccessCallback:function(a){if(this._successCallback&&typeof this._successCallback=="function"){this._successCallback(a);return true}else{return false}},getFailureCallback:function(){return this._failureCallback},setFailureCallback:function(a){this._failureCallback=a},callFailureCallback:function(a){if(this._failureCallback&&typeof this._failureCallback=="function"){this._failureCallback(a);return true}else{return false}},getCurl:function(){return this._curl},setCurl:function(a){this._curl=a},getToken:function(){return this._token},setToken:function(a){this._token=a},resetPaging:function(){this._previous=[];this._next=null;this._cursor=null},hasPrevious:function(){return this._previous.length>0},getPrevious:function(){this._next=null;this._cursor=this._previous.pop()},hasNext:function(){return this._next},getNext:function(){this._previous.push(this._cursor);this._cursor=this._next},saveCursor:function(a){if(this._next!=a){this._next=a}},getCursor:function(){return this._cursor}}})(Usergrid);(function(){Usergrid.Entity=function(a,b){this._collectionType=a;this._data={};this._uuid=b};Usergrid.Entity.prototype=new Usergrid.Query;Usergrid.Entity.prototype.getCollectionType=function(){return this._collectionType};Usergrid.Entity.prototype.setCollectionType=function(a){this._collectionType=a};Usergrid.Entity.prototype.get=function(a){if(a){return this._data[a]}else{return this._data}},Usergrid.Entity.prototype.set=function(a,b){if(typeof a=="object"){for(field in a){this._data[field]=a[field]}}else if(typeof a=="string"){this._data[a]=b}else{this._data=null}};Usergrid.Entity.prototype.save=function(a,b){var c=this.getCollectionType();var d="POST";if(this.get("uuid")){d="PUT";if(Usergrid.validation.isUUID(this.get("uuid"))){c+="/"+this.get("uuid")}}var e={};if(c=="users"){e=this.get();var f={};if(e.oldpassword&&e.newpassword){f.oldpassword=e.oldpassword;f.newpassword=e.newpassword;this.runAppQuery(new Usergrid.Query("PUT","users/"+uuid+"/password",f,null,function(a){},function(a){}))}delete e.oldpassword;delete e.newpassword}var g=this;e={};var h=this.get();for(var i in h){if(i=="metadata"||i=="created"||i=="modified"||i=="type"||i=="activatted"){continue}e[i]=h[i]}this.setAllQueryParams(d,c,e,null,function(c){try{var d=c.entities[0];g.set(d);if(typeof a=="function"){a(c)}}catch(e){if(typeof b=="function"){b(c)}}},function(a){if(typeof b=="function"){b(a)}});Usergrid.ApiClient.runAppQuery(this)};Usergrid.Entity.prototype.fetch=function(a,b){var c=this.getCollectionType();if(this.get("uuid")){c+="/"+this.get("uuid")}else{if(c=="users"){if(this.get("username")){c+="/"+this.get("username")}else{console.log("no username specified");if(typeof b=="function"){console.log("no username specified")}}}else{if(this.get()){c+="/"+this.get()}else{console.log("no entity identifier specified");if(typeof b=="function"){console.log("no entity identifier specified")}}}}var d=this;this.setAllQueryParams("GET",c,null,null,function(c){try{if(c.user){d.set(c.user)}var e=c.entities[0];d.set(e);if(typeof a=="function"){a(c)}}catch(f){if(typeof b=="function"){b(c)}}},function(a){if(typeof b=="function"){b(a)}});Usergrid.ApiClient.runAppQuery(this)};Usergrid.Entity.prototype.destroy=function(a,b){var c=this.getCollectionType();if(this.get("uuid")){c+="/"+this.get("uuid")}else{console.log("Error trying to delete object - no uuid specified.");if(typeof b=="function"){b("Error trying to delete object - no uuid specified.")}}var d=this;this.setAllQueryParams("DELETE",c,null,null,function(b){d.set(null);if(typeof a=="function"){a(b)}},function(a){if(typeof b=="function"){b(a)}});Usergrid.ApiClient.runAppQuery(this)}})(Usergrid);(function(){Usergrid.Collection=function(a,b){this._path=a;this._uuid=b;this._list=[];this._Query=new Usergrid.Query;this._iterator=-1};Usergrid.Collection.prototype=new Usergrid.Query;Usergrid.Collection.prototype.getPath=function(){return this._path};Usergrid.Collection.prototype.setPath=function(a){this._path=a};Usergrid.Collection.prototype.getUUID=function(){return this._uuid};Usergrid.Collection.prototype.setUUID=function(a){this._uuid=a};Usergrid.Collection.prototype.addEntity=function(a){var b=this._list.length;this._list[b]=a};Usergrid.Collection.prototype.addNewEntity=function(a,b,c){this.addEntity(a);a.save(b,c)};Usergrid.Collection.prototype.destroyEntity=function(a){var b=a.get("uuid");if(Usergrid.validation.isUUID(b)){var c=this._list.length;var d=0;var e=false;for(d=0;d<c;d++){if(e){this._list[d-1]=this._list[d];this._list[d]=null}if(this._list[d].get("uuid")==b){this._list[d]=null;e=true}}}a.destroy()};Usergrid.Collection.prototype.getEntityByField=function(a,b){var c=this._list.length;var d=0;for(d=0;d<c;d++){if(this._list[d].getField(a)==b){return this._list[d]}}return null};Usergrid.Collection.prototype.getEntityByUUID=function(a){var b=this._list.length;var c=0;for(c=0;c<b;c++){if(this._list[c].get("uuid")==a){return this._list[c]}}return null};Usergrid.Collection.prototype.getFirstEntity=function(){var a=this._list.length;if(a>0){return this._list[0]}return null};Usergrid.Collection.prototype.getLastEntity=function(){var a=this._list.length;if(a>0){return this._list[a-1]}return null};Usergrid.Collection.prototype.hasNextEntity=function(){var a=this._iterator+1;if(a>=0&&a<this._list.length){return true}return false};Usergrid.Collection.prototype.getNextEntity=function(){this._iterator++;if(this._iterator>=0&&this._iterator<=this._list.length){return this._list[this._iterator]}return false};Usergrid.Collection.prototype.hasPreviousEntity=function(){var a=this._iterator-1;if(a>=0&&a<this._list.length){return true}return false};Usergrid.Collection.prototype.getPreviousEntity=function(){this._iterator--;if(this._iterator>=0&&this._iterator<=this._list.length){return this.list[this._iterator]}return false};Usergrid.Collection.prototype.resetEntityPointer=function(){this._iterator=-1};Usergrid.Collection.prototype.getEntityList=function(){return this._list};Usergrid.Collection.prototype.setEntityList=function(a){this._list=a};Usergrid.Collection.prototype.hasNextPage=function(){return this.hasNext()};Usergrid.Collection.prototype.getNextPage=function(){if(this.hasNext()){this.getNext();this.setEntityList([]);Usergrid.ApiClient.runAppQuery(this)}};Usergrid.Collection.prototype.hasPreviousPage=function(){return this.hasPrevious()};Usergrid.Collection.prototype.getPreviousPage=function(){if(this.hasPrevious()){this.getPrevious();this.setEntityList([]);Usergrid.ApiClient.runAppQuery(this)}};Usergrid.Collection.prototype.clearQuery=function(){this.clearAll()};Usergrid.Collection.prototype.get=function(a,b){var c=this;var d=this.getQueryParams();this.setEntityList([]);this.setAllQueryParams("GET",this.getPath(),null,d,function(d){if(d.entities){this.resetEntityPointer();var e=d.entities.length;for(var f=0;f<e;f++){var g=d.entities[f].uuid;if(g){var h=new Usergrid.Entity(c.getPath(),g);var i=d.entities[f]||{};delete i.uuid;h.set(i);c.addEntity(h)}}if(typeof a=="function"){a(d)}}else{if(typeof b=="function"){b(d)}}},function(a){if(typeof b=="function"){b(a)}});Usergrid.ApiClient.runAppQuery(this)};Usergrid.Collection.prototype.save=function(a,b){var c=this.getEntityList();var d=c.length;var e=[];for(var f=0;f<d;f++){entity=c[f];data=entity.get();if(entity.get("uuid")){data.uuid=entity.get("uuid");e.push(data)}entity.save()}this.setAllQueryParams("PUT",this.getPath(),e,null,a,b);Usergrid.ApiClient.runAppQuery(this)}})(Usergrid);Usergrid.M="ManagementQuery";Usergrid.A="ApplicationQuery";Usergrid.ApiClient=function(){function n(a,c){b=a;d=c}function o(a){var b="/"+this.getOrganizationName()+"/"+this.getApplicationName()+"/";M(Usergrid.A);N(a,b,self)}function p(a){var b="/management/";M(Usergrid.M);N(a,b,self)}function q(){return b}function r(a){b=a}function s(){return c}function t(a){c=a}function u(){return d}function v(a){d=a}function w(){return e}function x(a){e=a}function y(){return a}function z(b){a=b}function A(){y()+"/management/users/resetpw"}function B(){return this._loggedInUser}function C(a){this._loggedInUser=a}function D(a,b,c,d){var e=this;var f={username:a,password:b,grant_type:"password"};this.runAppQuery(new Usergrid.Query("GET","token",null,f,function(a){var b=new Usergrid.Entity("users");b.set("username",a.user.username);b.set("name",a.user.name);b.set("email",a.user.email);b.set("uuid",a.user.uuid);e.setLoggedInUser(b);e.setToken(a.access_token);if(c&&typeof c=="function"){c(a)}},function(a){if(d&&typeof d=="function"){d(a)}}))}function E(){}function F(){this._loggedInUser=null;this.setToken(null)}function G(){var a=this.getLoggedInUser();return this.getToken()&&Usergrid.validation.isUUID(a.get("uuid"))}function H(){return m}function I(a){m=a}function J(){if(m&&typeof m=="function"){m();return true}else{return false}}function K(a){tail=[];var b=[];if(a instanceof Array){for(i in a){b=a[i];if(b instanceof Array&&b.length>1){tail.push(b[0]+"="+encodeURIComponent(b[1]))}}}else{for(var c in a){if(a.hasOwnProperty(c)){var d=a[c];if(d instanceof Array){for(i in d){b=d[i];tail.push(c+"="+encodeURIComponent(b))}}else{tail.push(c+"="+encodeURIComponent(d))}}}}return tail.join("&")}function L(){return k}function M(a){k=a}function N(a,b){var c="curl";try{if(!(a instanceof Usergrid.Query)){throw new Error("Query is not a valid object.")}a.setQueryStartTime();var d=a.getMethod().toUpperCase();var e=a.getResource();var f=a.getJsonObj()||{};var g=a.getQueryParams()||{};if(d!="GET"&&d!="POST"&&d!="PUT"&&d!="DELETE"){throw new Error("Invalid method - should be GET, POST, PUT, or DELETE.")}if(d=="POST"){c+=" -X POST"}else if(d=="PUT"){c+=" -X PUT"}else if(d=="DELETE"){c+=" -X DELETE"}else{c+=" -X GET"}var h=Usergrid.ApiClient.getApplicationName();if(h){h=h.toUpperCase()}if(h!="SANDBOX"&&Usergrid.ApiClient.getToken()||L()==Usergrid.M&&Usergrid.ApiClient.getToken()){c+=' -i -H "Authorization: Bearer '+Usergrid.ApiClient.getToken()+'"';a.setToken(true)}_params=JSON.stringify(g);if(!JSON.parse(_params)){throw new Error("Params object is not valid.")}if(a.getCursor()){g.cursor=a.getCursor()}else{delete g.cursor}b=b.indexOf("/")==0?b.substring(1):b;e=b+e;if(e){while(e.indexOf("//")!=-1){e=e.replace("//","/")}}e=Usergrid.ApiClient.getApiUrl()+e;c+=' "'+e;var i=K(g);if(i){c+="?"+i}c+='"';if(d=="GET"||d=="DELETE"){g["_"]=(new Date).getTime()}var j=K(g);if(j){e+="?"+j}f=JSON.stringify(f);if(!JSON.parse(f)){throw new Error("JSON object is not valid.")}if(f=="{}"){f=null}else{c+=" -d '"+f+"'"}}catch(k){console.log("error occured running query -"+k.message);return false}console.log(c);a.setCurl(c);var l=window.XDomainRequest?true:false;var m=window.XMLHttpRequest?true:false;var n;if(l){n=new window.XDomainRequest;if(Usergrid.ApiClient.getToken()){if(e.indexOf("?")){e+="&access_token="+Usergrid.ApiClient.getToken()}else{e="?access_token="+Usergrid.ApiClient.getToken()}}n.open(d,e,true)}else if(m){n=new XMLHttpRequest;n.open(d,e,true);if(Usergrid.ApiClient.getToken()){n.setRequestHeader("Authorization","Bearer "+Usergrid.ApiClient.getToken());n.withCredentials=true}}else{n=new ActiveXObject("MSXML2.XMLHTTP.3.0");if(Usergrid.ApiClient.getToken()){if(e.indexOf("?")){e+="&access_token="+Usergrid.ApiClient.getToken()}else{e="?access_token="+Usergrid.ApiClient.getToken()}}n.open(d,e,true)}if(f){n.setRequestHeader("Content-Type","application/json")}n.ontimeout=n.onerror=function(){a.setQueryEndTime();console.log(a.getQueryTotalTime());clearTimeout(o);console.log("API call failed at the network level.");a.callFailureCallback({error:"error"})};n.onprogress=function(){};n.onload=function(){a.setQueryEndTime();console.log("Call timing: "+a.getQueryTotalTime());clearTimeout(o);if(n.status!=200&&!l){var b="";try{b=n.statusText;b=b.toLowerCase()}catch(c){}console.log("API call failed: (status: "+n.status+") - "+b);if(b=="auth_expired_session_token"||b=="unauthorized"||b=="auth_missing_credentials"||b=="auth_invalid"){J();return}}try{response=JSON.parse(n.responseText)}catch(c){a.callFailureCallback(response);return}if(response){var d=response.cursor||null;a.saveCursor(d);a.callSuccessCallback(response)}else{a.callFailureCallback()}};var o=setTimeout(function(){n.abort()},15e3);n.send(f)}var a="https://api.usergrid.com/";var b=null;var c=null;var d=null;var e=null;var f=null;var g=null;var h=null;var j=null;var k=null;var l=null;var m=null;return{init:n,runAppQuery:o,runManagementQuery:p,getOrganizationName:q,setOrganizationName:r,getOrganizationUUID:s,setOrganizationUUID:t,getApplicationName:u,setApplicationName:v,getToken:w,setToken:x,getApiUrl:y,setApiUrl:z,getResetPasswordUrl:A,getLoggedInUser:B,setLoggedInUser:C,logInAppUser:D,renewAppUserToken:E,logoutAppUser:F,isLoggedInAppUser:G,getLogoutCallback:H,setLogoutCallback:I,callLogoutCallback:J}}();Usergrid.validation=function(){function g(b,c){if(a.test(b)&&s(b,4,80)){return true}else{if(c&&typeof c=="function"){c(this.getUsernameAllowedChars())}return false}}function h(){return"Length: min 4, max 80. Allowed: A-Z, a-z, 0-9, dot, and dash"}function i(a,c){if(b.test(a)&&s(a,4,16)){return true}else{if(c&&typeof c=="function"){c(this.getNameAllowedChars())}return false}}function j(){return"Length: min 4, max 80. Allowed: A-Z, a-z, 0-9, ~ @ # % ^ & * ( ) - _ = + [ ] { } \\ | ; : ' \" , . / ? !"}function k(a,b){if(d.test(a)&&s(a,5,16)){return true}else{if(b&&typeof b=="function"){b(this.getPasswordAllowedChars())}return false}}function l(){return"Length: min 5, max 16. Allowed: A-Z, a-z, 0-9, ~ @ # % ^ & * ( ) - _ = + [ ] { } \\ | ; : ' \" , . < > / ? !"}function m(a,b){if(c.test(a)&&s(a,4,80)){return true}else{if(b&&typeof b=="function"){b(this.getEmailAllowedChars())}return false}}function n(){return"Email must be in standard form: e.g. example@Usergrid.com"}function o(a,b){if(e.test(a)&&s(a,4,80)){return true}else{if(b&&typeof b=="function"){b(this.getPathAllowedChars())}return false}}function p(){return"Length: min 4, max 80. Allowed: /, a-z, 0-9, dot, and dash"}function q(a,b){if(f.test(a)&&s(a,4,80)){return true}else{if(b&&typeof b=="function"){b(this.getTitleAllowedChars())}return false}}function r(){return"Length: min 4, max 80. Allowed: space, A-Z, a-z, 0-9, dot, dash, /, !, and ?"}function s(a,b,c){if(a.length>c||a.length<b){return false}return true}function t(a){var b=/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/;if(!a)return false;return b.test(a)}var a=new RegExp("^([0-9a-zA-Z.-])+$");var b=new RegExp("^([0-9a-zA-Z@#$%^&!?;:.,'\"~*-=+_[\\](){}/\\ |])+$");var c=new RegExp("^(([0-9a-zA-Z]+[_+.-]?)+@[0-9a-zA-Z]+[0-9,a-z,A-Z,.,-]*(.){1}[a-zA-Z]{2,4})+$");var d=new RegExp("^([0-9a-zA-Z@#$%^&!?<>;:.,'\"~*-=+_[\\](){}/\\ |])+$");var e=new RegExp("^([0-9a-z./-])+$");var f=new RegExp("^([0-9a-zA-Z.!-?/])+$");return{validateUsername:g,getUsernameAllowedChars:h,validateName:i,getNameAllowedChars:j,validatePassword:k,getPasswordAllowedChars:l,validateEmail:m,getEmailAllowedChars:n,validatePath:o,getPathAllowedChars:p,validateTitle:q,getTitleAllowedChars:r,isUUID:t}}()